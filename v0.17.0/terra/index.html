
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.2.4">
    
    
      
        <title>WorkFlow Launcher's Role in Terra - Workflow Launcher</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f7f47774.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="teal">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#workflow-launchers-role-in-terra" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Workflow Launcher" class="md-header__button md-logo" aria-label="Workflow Launcher" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Workflow Launcher
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              WorkFlow Launcher's Role in Terra
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/broadinstitute/wfl/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Workflow Launcher" class="md-nav__button md-logo" aria-label="Workflow Launcher" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Workflow Launcher
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/broadinstitute/wfl/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Get Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Development Guide
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Development Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Development Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../dev-process/" class="md-nav__link">
        Development Process and Tips
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../dev-release/" class="md-nav__link">
        Release Process
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../dev-logging/" class="md-nav__link">
        Logging
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../dev-monitoring/" class="md-nav__link">
        Monitoring
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Staged Workloads
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Staged Workloads" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Staged Workloads
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../staged-workload/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../staged-api-usage/" class="md-nav__link">
        API Usage
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../staged-source/" class="md-nav__link">
        Source
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../staged-executor/" class="md-nav__link">
        Executor
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../staged-sink/" class="md-nav__link">
        Sink
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Module-Specific Usage
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Module-Specific Usage" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Module-Specific Usage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../modules-general/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../modules-aou-arrays/" class="md-nav__link">
        Arrays
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../modules-external-exome-reprocessing/" class="md-nav__link">
        External Exome
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../modules-sg/" class="md-nav__link">
        Somatic Genomes
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../modules-wgs/" class="md-nav__link">
        Whole Genome
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        General Usage
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="General Usage" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          General Usage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../usage-workflow-options/" class="md-nav__link">
        Workflow Options
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../usage-across-directory/" class="md-nav__link">
        Usage Across a Directory
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../usage-retry/" class="md-nav__link">
        Retrying Workflows
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../usage-abort/" class="md-nav__link">
        Aborting a Workload
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      <label class="md-nav__link" for="__nav_6">
        Readings
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Readings" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Readings
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          WorkFlow Launcher's Role in Terra
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        WorkFlow Launcher's Role in Terra
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#history" class="md-nav__link">
    History
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-role-of-wfl-in-terra" class="md-nav__link">
    The role of WFL in Terra
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wfl-concepts" class="md-nav__link">
    WFL Concepts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wfl-server" class="md-nav__link">
    WFL server
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#history" class="md-nav__link">
    History
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-role-of-wfl-in-terra" class="md-nav__link">
    The role of WFL in Terra
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wfl-concepts" class="md-nav__link">
    WFL Concepts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wfl-server" class="md-nav__link">
    WFL server
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/broadinstitute/wfl/edit/master/docs/terra.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="workflow-launchers-role-in-terra">WorkFlow Launcher's Role in Terra<a class="headerlink" href="#workflow-launchers-role-in-terra" title="Permanent link">⚓︎</a></h1>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">⚓︎</a></h2>
<p>The Data Sciences Platform (DSP) is building a new system (around
<a href="https://terra.bio/">Terra</a>) for storing and processing biological
data. The system design includes a Data Repository where data is
stored, and a Methods Repository that executably describes
transformations on that data.</p>
<p>In the new system, the DSP needs something to fulfill the role that
Zamboni currently plays in DSP's current infrastructure to support
the Genomics Platform (GP).</p>
<p>Zamboni watches various queues for messages describing new data and
how to process it. Zamboni interprets those messages to dispatch
work to workflow engines (running on the premises or in the cloud)
and monitors the progress of those workflows. The Zamboni web UI
allows users to track the progress of workflows, and enables Ops
engineers to debug problems and resume or restart failed workflows.
Zamboni can run workflows on both a local Sun Grid Engine (SGE), and
on Cromwell on premises and in the cloud.</p>
<p>We think that WFL can fill the role of Zamboni in the new data
storage and processing system that DSP is developing now.</p>
<h2 id="history">History<a class="headerlink" href="#history" title="Permanent link">⚓︎</a></h2>
<p>WFL began as a project to replace a Zamboni <em>starter</em>, with the old
name "Zero". A <em>starter</em> is a Zamboni component that brokers messages
among the queues that Zamboni watches. It interprets messages
queued from a Laboratory Information Management System (LIMS),
such as the Mercury web service, and demultiplexes them to other
Zamboni queues.</p>
<p>Zero was later adapted to manage the reprocessing of the first batch
of UK Biobank exomes. It has since been adapted to drive workflows
for other projects at the Broad.</p>
<p>Zero is unusual in that it usually runs as a stateless command line
program without special system privilege, and interfaces with
services running both on premises and in Google Cloud. It also
manages a processing workload as a set of inputs mapped to outputs
instead of tracking the progress of individual sample workflows.</p>
<p>A Zero user need only specify a source of inputs, a workflow to run,
an execution environment, and an output location. Then each time it
is invoked, Zero ensures that workflows are started and retried as
needed until an output exists for every input.</p>
<p>Zero has recently been adapted again to deploy as a web service
under Google App Engine (GAE) though most of the value of Zero is
still not available to the server. And now it has the new name WFL.</p>
<h2 id="the-role-of-wfl-in-terra">The role of WFL in Terra<a class="headerlink" href="#the-role-of-wfl-in-terra" title="Permanent link">⚓︎</a></h2>
<p>Diagrams of the new DSP processing system show a WFL service
subscribed to event streams from the Data Repository (DR), with
interfaces to both the Data and the Method Repositories.</p>
<p>The implication is that something notifies WFL of new data in the
Data Repository and WFL determines how to process it somehow. WFL
then looks up whatever is required from the Method Repository, calls
on other services as necessary to process the data and writes the
results back to the DR. There is also, presumably, a web UI to track
and debug the workflows managed by WFL.</p>
<p>Many details are yet to be worked out.</p>
<h2 id="wfl-concepts">WFL Concepts<a class="headerlink" href="#wfl-concepts" title="Permanent link">⚓︎</a></h2>
<p>WFL is designed around several novel concepts.</p>
<ol>
<li>
<p>Manage workloads instead of workflows.</p>
<p>This is the biggest difference between Zamboni and Zero (WFL).
Zamboni manages workflows whereas WFL manages <strong>workloads</strong>.</p>
<p>Zamboni's unit of work is the <em>workflow</em>. Zamboni manages each
workflow separately.</p>
<p>A <em>workflow</em> is a transformation specified in WDL or Scala code
that succeeds or fails to produce a result. The input to a
workflow and its result may consist of multiple files, but they
represent a single unit of work managed by a workflow engine
such as Cromwell. Zamboni prepares a new workflow for each
message it receives by packaging up the input and submitting it
to a workflow engine. It then monitors that workflow and reports
on its success or failure.</p>
<p>WFL manages a <em>workload</em>, which indirectly comprises multiple
workflows. Each workflow maps an input to some output, but WFL
generally tracks only the inputs and outputs instead of the
workflows themselves.</p>
<p>Think of a workload as a set of inputs transformed via a
workflow engine into a set of outputs. Call that set of outputs
the <em>result set</em>. WFL generally does not care whether any
individual workflow succeeds or fails. It merely considers all
possible inputs specified by the workload, and looks for inputs
whose outputs are missing from the result set. If some input
lacks an output in the result set, WFL starts a new workflow to
process that input.</p>
<p>Note: This characterization is unfair to Zamboni. Zamboni also
had to manage multiple workflows before the advent of Cromwell
and still does when running workflows on SGE. But WFL can take
advantage of Cromwell's job management to simplify its
implementation.</p>
</li>
<li>
<p>Specify inputs and outputs by general predicates.</p>
<p>Each Zamboni message explicitly specifies an input to be
processed. Zamboni then starts a workflow for that input and
reports its status. Zamboni reports failure so a user can debug
and manually <em>succeed</em>, reconsider, or restart the workflow. The
output of a successful workflow is not Zamboni's concern.</p>
<p>WFL finds inputs by applying a predicate specified by the user
subject to some run-time constraint. Then WFL applies a
function to each input to find how that input maps to the result
set. Another predicate applied to the input, and its output in
the result set, determines whether WFL will launch a workflow
on that input.</p>
<p>Those predicates and function can be anything expressed in a
programming language. The run-time constraint is some strings
passed on the command line.</p>
</li>
<li>
<p>Minimize user input and decisions at run time.</p>
<p>WFL gathers the predicates and mapping functions described
above into a <em>module</em> that also knows how to generate everything
a workflow engine needs to launch the workflow to process an
input into a result output.</p>
<p>That module name is one of a few run-time constraints specified
by strings in a web form or on a command line. Further
constraints are usually one or two of the following:</p>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">processing</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="p">(</span><span class="n n-Quoted">`dev`</span><span class="w"> </span><span class="n n-Quoted">`prod`</span><span class="w"> </span><span class="n n-Quoted">`pharma5`</span><span class="p">),</span><span class="w"></span>
<span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="k">system</span><span class="w"> </span><span class="k">directory</span><span class="w"> </span><span class="p">(</span><span class="n n-Quoted">`/seq/tng/tbl/`</span><span class="w"></span>
<span class="n n-Quoted">`file://home/tbl/`</span><span class="p">),</span><span class="w"></span>
<span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">cloud</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">prefix</span><span class="w"> </span><span class="p">(</span><span class="n n-Quoted">`gs://bucket/folder/`</span><span class="w"></span>
<span class="n n-Quoted">`s3://bucket/`</span><span class="p">),</span><span class="w"></span>
<span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">pathname</span><span class="w"> </span><span class="n">suffix</span><span class="w"> </span><span class="p">(</span><span class="n n-Quoted">`.cram`</span><span class="w"> </span><span class="n n-Quoted">`.vcf`</span><span class="p">),</span><span class="w"></span>
<span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">spreadsheet</span><span class="w"> </span><span class="p">(</span><span class="k">or</span><span class="w"> </span><span class="kt">JSON</span><span class="p">,</span><span class="w"> </span><span class="n">TSV</span><span class="p">,</span><span class="w"> </span><span class="n">CSV</span><span class="p">,</span><span class="w"> </span><span class="k">XML</span><span class="p">)</span><span class="w"> </span><span class="n">filename</span><span class="w"></span>
<span class="o">-</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">predicate</span><span class="p">.</span><span class="w"></span>
</code></pre></div>

<p>The module interprets the other constraints, determines which
processing environments are allowed, and parses any files named
accordingly.</p>
</li>
<li>
<p>Maintain provenance.</p>
<p>WFL runs out of a single JARfile built entirely from sources
pulled from Git repositories. WFL records the Git commit hashes
in the JARfile and adds them to every Cromwell workflow it
starts. WFL can also preserve the Cromwell metadata alongside
any result files generated by the workflow.</p>
</li>
<li>
<p>Run with minimal privilege.</p>
<p>Zamboni runs as a service with system account credentials such
as <code>picard</code>.</p>
<p>WFL is designed to run as whoever invokes it, such as
<code>tbl@broadinstitute.org</code>. WFL fetches the users credentials
from the environment when invoked from the command line. WFL
requires authentication when running as a server, and constructs
a JSON Web Token (JWT) to authorize other services as needed.</p>
</li>
<li>
<p>Limit dependencies.</p>
<p>WFL depends on a Java runtime,
and Gnu make
and the Clojure CLI
to manage dependencies.
Of course, it also pulls in numerous Clojure and Java
libraries at build time, and sources WDL files from the
<code>warp</code> repository.
A programmer need only install Clojure,
clone the <code>wfl</code> Git repository,
and run <code>make</code>
to bootstrap WFL from source.</p>
</li>
</ol>
<h2 id="wfl-server">WFL server<a class="headerlink" href="#wfl-server" title="Permanent link">⚓︎</a></h2>
<p>The WFL client is a command-line batch program that a person runs
intermittently on a laptop or virtual machine (VM).</p>
<p>We are working to port the client functions of WFL to a ubiquitous
web service (WFL server) running in Google Cloud. That port
requires we solve several problems.</p>
<ol>
<li>
<p>State</p>
<p>The WFL client is a stateless program that relies on consistent
command line arguments to provide the constraints needed to
drive the input discovery predicates and so on. Each user runs a
separate process that lasts only as long as necessary to
complete some stage of a workload.</p>
<p>The WFL server is shared among all its users and runs
continually. Therefore it requires some kind of data store (a
database) to maintain the state of each workload across
successive connections from web browsers.</p>
<p>We intend to use the hosted Postgres service available to GAE
applications for this. This work is already underway (GH-573).</p>
</li>
<li>
<p>Authorization</p>
<p>The WFL client assumes it runs in an authenticated context. It
can pull credentials from the environment on every invocation
that requires authorization to a service.</p>
<p>The WFL server will also need to authorize services to run as
some authenticated user, but cannot assume the credentials are
always available, nor that there is a user present to provide
them. WFL can already use OAuth2.0 to authenticate users
against an identity provider and use the resulting credentials
to build a JWT. It can also derive the bearer token required by
most of our authorized services from a JWT.</p>
<p>But WFL also needs some secure JWT store, so tokens are
available to authorize services even when there is no active
user connection. It also needs some mechanism to refresh tokens
as they expire to support long-running workloads.</p>
</li>
<li>
<p>Workload specification</p>
<p>The user of a WFL service needs some way to specify a workload.
A workload may be some set of inputs and the kind of workflow to
run on them.</p>
<p>A WFL client user now specifies a workload with a <em>module</em> name
and a <em>constraint</em>. For example, <code>ukb pharma5 110000
gs://broad-ukb/in/ gs://broad-ukb/out/</code> means find up to
<code>110000</code> cloud objects with names prefixed with
<code>gs://broad-ukb/in/</code>, process them in the Cromwell set up for
<code>pharma5</code>, and store their outputs under <code>gs://broad-ukb/out/</code>
somewhere.</p>
<p>The <code>ukb</code> module knows how to find <code>.aligned.cram</code> files under
the <code>gs://broad-ukb/in/</code> cloud path and set up the WDL and
Cromwell dependencies and options necessary to reprocess them
into <code>.cram</code> output files. The <code>ukb</code> module also knows how to
find the Cromwell deployed to support <code>pharma5</code> workloads, how
to authorize the user to that Cromwell, and how to read any
supporting data from other services. And finally, the <code>ukb</code>
module knows how to determine which inputs do not yet have
outputs under the <code>gs://broad-ukb/out/</code> cloud path, and do not
have workflows running in the <code>pharma5</code> Cromwell.</p>
<p>In an ideal design, this workload specification would integrate
conveniently with the Data Repository's subscription or
<em>eventing</em> service. In any case though, WFL needs some
interface through which a user can specify what needs to be
done.</p>
</li>
<li>
<p>Workload management</p>
<p>Workloads need to be started, stopped, and monitored somehow.
This implies that there is some way to find active or suspended
workloads, and affordances for acting on them.</p>
<p>Users need some way to monitor the progress of a workload, and
to find and debug workloads encountering unacceptable workflow
failures.</p>
<p>Monitoring and diagnostic code already exists in various WFL
modules, but there is no easy way to use them from a web
browser.</p>
</li>
<li>
<p>Service interface</p>
<p>WFL should be useful to programs other than web browsers. It is
easy to imagine Terra users wanting to query WFL for the status
of workloads directly without buggy and tedious screen scraping.</p>
<p>WFL should at least export a query endpoint for use by other
reporting services as well as its own browser interface. It
would be nice to provide a familiar JSON or GraphQL query syntax
to other services.</p>
</li>
<li>
<p>Browser interface</p>
<p>A browser interface should require little in addition to WFL's
service interface. Ideally, one should be able to adapt WFL to
new workloads via a browser interface without requiring a
redeployment.</p>
</li>
</ol>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../usage-abort/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Aborting a Workload" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Aborting a Workload
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/broadinstitute/wfl" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.top", "navigation.sections", "navigation.instant"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.709b4209.min.js", "version": 2.0}</script>
    
    
      <script src="../assets/javascripts/bundle.febc23d1.min.js"></script>
      
    
  </body>
</html>