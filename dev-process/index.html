
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.0.2">
    
    
      
        <title>Development Process and Tips - Workflow Launcher</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.38780c08.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f72e892.min.css">
        
          
          
          <meta name="theme-color" content="#4cae4f">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="teal">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#development-process" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Workflow Launcher" class="md-header-nav__button md-logo" aria-label="Workflow Launcher">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Workflow Launcher
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Development Process and Tips
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/broadinstitute/wfl/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Workflow Launcher" class="md-nav__button md-logo" aria-label="Workflow Launcher">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Workflow Launcher
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/broadinstitute/wfl/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Get Started
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Development Guide
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Development Guide" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Development Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Development Process and Tips
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Development Process and Tips
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-swagger-page" class="md-nav__link">
    The Swagger page
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#development-setup" class="md-nav__link">
    Development Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#process" class="md-nav__link">
    Process
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#development-tips" class="md-nav__link">
    Development Tips
  </a>
  
    <nav class="md-nav" aria-label="Development Tips">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#migrating-a-database" class="md-nav__link">
    migrating a database
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging-jdbc-sql" class="md-nav__link">
    debugging JDBC SQL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging-api-specs" class="md-nav__link">
    debugging API specs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hacking-a-scratch-database" class="md-nav__link">
    hacking a scratch database
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#useful-hacks-for-debugging-postgresliquibase-locally" class="md-nav__link">
    Useful hacks for debugging Postgres/Liquibase locally
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagnosis" class="md-nav__link">
    Diagnosis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dev-sandbox/" class="md-nav__link">
      Local Development SandBox
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dev-logging/" class="md-nav__link">
      Logging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dev-deployment/" class="md-nav__link">
      Deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dev-frontend/" class="md-nav__link">
      Frontend
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Modules
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Modules" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Modules
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../modules-general/" class="md-nav__link">
      General
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../modules-arrays/" class="md-nav__link">
      Arrays
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dev-wgs/" class="md-nav__link">
      Whole Genome
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Readings
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Readings" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Readings
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../terra/" class="md-nav__link">
      WorkFlow Launcher's Role in Terra
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-swagger-page" class="md-nav__link">
    The Swagger page
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#development-setup" class="md-nav__link">
    Development Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#process" class="md-nav__link">
    Process
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#development-tips" class="md-nav__link">
    Development Tips
  </a>
  
    <nav class="md-nav" aria-label="Development Tips">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#migrating-a-database" class="md-nav__link">
    migrating a database
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging-jdbc-sql" class="md-nav__link">
    debugging JDBC SQL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging-api-specs" class="md-nav__link">
    debugging API specs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hacking-a-scratch-database" class="md-nav__link">
    hacking a scratch database
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#useful-hacks-for-debugging-postgresliquibase-locally" class="md-nav__link">
    Useful hacks for debugging Postgres/Liquibase locally
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagnosis" class="md-nav__link">
    Diagnosis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/broadinstitute/wfl/edit/master/docs/dev-process.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="development-process">Development Process<a class="headerlink" href="#development-process" title="Permanent link">&para;</a></h1>
<p>This is a development process
we are tying to standardize
within the team,
and encourage ourselves
to follow in most cases.</p>
<h2 id="the-swagger-page">The Swagger page<a class="headerlink" href="#the-swagger-page" title="Permanent link">&para;</a></h2>
<p>WFL ships with a swaggger UI that documents all of the
available endpoints. It's available at path <code>/swagger</code>, e.g.
https://dev-wfl.gotc-dev.broadinstitute.org/swagger</p>
<h2 id="development-setup">Development Setup<a class="headerlink" href="#development-setup" title="Permanent link">&para;</a></h2>
<p>Clojure development feels very different from Scala and Java
development. It even differs markedly from development in other
<em>dynamic languages</em> such as Python or Ruby.</p>
<p>Get a demonstration from someone familiar with Clojure
development before you spend too much time trying to figure
things out on your own.</p>
<p>Find a local Cursive user for guidance if you like IntelliJ.
<a href="mailto:chengche@broadinstitute.org">Rex Wang</a> and
<a href="mailto:sehsan@broadinstitute.org">Saman Ehsan</a> know how to use it.
Cursive licences are available
<a href="https://broadinstitute.atlassian.net/wiki/spaces/DSDE/pages/48234557/Software%2BLicenses%2B-%2BCursive">here</a>.
The steps for getting this project set up with very recent versions of IntelliJ
differ from Cursive's docs:</p>
<details class="tip" open="open"><summary>Tip</summary><p>It is recommended to run <code>prebuild</code> before launching IntelliJ
as it sets up all libraries and derived resources and sources:
<div class="highlight"><pre><span></span><code>make <span class="nv">TARGET</span><span class="o">=</span>prebuild - jN
</code></pre></div></p>
</details>
<ol>
<li><em>Outside of IntelliJ</em>, <code>clone</code> the repo and run <code>boot</code> at the top-level to
generate the <code>project.clj</code> (see below)</li>
<li><em>Now inside of IntelliJ</em>, import the project by specifically targeting the
<code>project.clj</code> file (it should offer to import the entire project, and targeting
the <code>project.clj</code> will make use of Leiningen to work with Cursive)</li>
<li>Use the Project Structure window (Help -&gt; Find Action -&gt; Project Structure) to set a JDK as the Project SDK</li>
</ol>
<p>There is also a
<a href="https://marketplace.visualstudio.com/items?itemName=betterthantomorrow.calva">Calva</a>
plugin for <a href="https://code.visualstudio.com/">Visual Studio Code</a>.</p>
<p>I hack Clojure in Emacs using
<a href="https://cider.readthedocs.io/">CIDER</a> and
<a href="https://github.com/clojure/tools.nrepl">nREPL</a>. CIDER is not
trivial to set up, but not <em>especially</em> difficult if you are
used to Emacs. (I can help if CIDER gives you trouble.)</p>
<p>Every time <code>boot</code> runs, it generates a <code>project.clj</code> file to
support <code>lein</code>, Cursive, and Calva users.</p>
<p>Running <code>boot build</code> will not only build a fat jar (<em>uberjar</em>)
for the WFL project, but will add an executable symbolic link
<code>wfl</code> to conveniently execute the Clojure code as a script.</p>
<h2 id="process">Process<a class="headerlink" href="#process" title="Permanent link">&para;</a></h2>
<p>We always make feature branches from <code>master</code>,
make pull requests,
ask for reviews
and merge back to <code>master</code> on Github.</p>
<p>Currently we always deploy the latest master
to the development environment after merge,
but in the future we might need
to cut off releases on master
and deploy the released versions
to the server only.
It's not decided yet.</p>
<ol>
<li>
<p>Clone the repo
    <div class="highlight"><pre><span></span><code>git@github.com:broadinstitute/wfl.git
</code></pre></div></p>
</li>
<li>
<p>Start from the latest copy of the remote master
    <div class="highlight"><pre><span></span><code>git checkout master
git pull origin master
</code></pre></div></p>
</li>
<li>
<p>Create a feature branch</p>
<p><em>It is highly recommend that you follow the naming convention
shown below so JIRA could pick up the branch and link it
to our JIRA board.</em>
<div class="highlight"><pre><span></span><code>git checkout -b tbl/GH-666-feature-branch-something
</code></pre></div></p>
</li>
<li>
<p>Start your work, add and commit your changes
    <div class="highlight"><pre><span></span><code>git add &quot;README.md&quot;
git commit -m &quot;Update the readme file.&quot;
</code></pre></div></p>
</li>
<li>
<p>[Optional] Rebase onto lastet master: only if you want to get updates from the master
    <div class="highlight"><pre><span></span><code>git checkout master
git pull origin master
git checkout tbl/GH-666-feature-branch-something
git rebase master
</code></pre></div></p>
<p>alternatively, you could use the following commands without switching branches:
<div class="highlight"><pre><span></span><code>git checkout tbl/GH-666-feature-branch-something
git fetch origin master
git merge master
</code></pre></div></p>
</li>
<li>
<p>Push branch to Github in the early stage of your development (recommended):
    <div class="highlight"><pre><span></span><code>git push --set-upstream origin tbl/GH-666-feature-branch-something
</code></pre></div></p>
</li>
<li>
<p>Create the pull request on Github UI. Be sure to fill out the PR description following the PR template instructions.</p>
<ul>
<li>
<p>If the PR is still in development, make sure use the dropdown menu and choose <code>Create draft pull request</code></p>
</li>
<li>
<p>If the PR is ready for review, click <code>Create pull request</code>.</p>
</li>
</ul>
</li>
<li>
<p>Look for a reviewer in the team.</p>
</li>
<li>
<p>Address reviewer comments with more commits.</p>
</li>
<li>
<p>Receive approval from reviewers.</p>
</li>
<li>
<p>Make sure build the backend code at least once with:
    <div class="highlight"><pre><span></span><code>make api
</code></pre></div></p>
</li>
<li>
<p>Merge the PR. The feature branch will be automatically cleaned up.</p>
</li>
<li>
<p>[Temporary] Fetch the lastest master branch again and deploy it to dev server.
    <div class="highlight"><pre><span></span><code>git checkout master
git pull origin master
boot deploy
</code></pre></div></p>
<p>you might need to login to vault and google by the following commands before you want to deploy:
<div class="highlight"><pre><span></span><code>vault auth -method=github token=$(cat ~/.github-token)
gcloud auth login
</code></pre></div></p>
<p><strong>Note: this action might interfere other people's work that is under QA, please always coordinate before you do this!</strong></p>
</li>
</ol>
<h2 id="development-tips">Development Tips<a class="headerlink" href="#development-tips" title="Permanent link">&para;</a></h2>
<p>Here are some tips for WFL development.</p>
<p>Some of this advice might help
when testing Liquibase migration
or other changes
that affect WFL's Postgres database.</p>
<h3 id="migrating-a-database">migrating a database<a class="headerlink" href="#migrating-a-database" title="Permanent link">&para;</a></h3>
<p>To change WFL's Postgres database schema,
add a changeset XML file
in the <code>database/changesets</code> directory.
Name the file for a recent or the current date
followed by something describing the change.
That will ensure that the changesets
list in the order in which they apply.
Note that the <code>id</code> and <code>logicalFilePath</code> attributes
are derived from the changeset's file name.
Then add the changeset file
to the <code>database/changlog.xml</code> file.</p>
<p>Test the changes against a local <em>scratch database</em>.
See the next section for suggestions.</p>
<h3 id="debugging-jdbc-sql">debugging JDBC SQL<a class="headerlink" href="#debugging-jdbc-sql" title="Permanent link">&para;</a></h3>
<p>Something seems to swallow SQL exceptions
raised by Postgres and the JDBC library.
Wrap suspect <code>clojure.java.jdbc</code> calls
in <code>wfl.util/do-or-nil</code> to ensure
that any exceptions show up
in the server logs.</p>
<h3 id="debugging-api-specs">debugging API specs<a class="headerlink" href="#debugging-api-specs" title="Permanent link">&para;</a></h3>
<p>If an API references an undefined spec,
HTTP requests and responses might silently fail
or the Swagger page will fail to render.
Check the <code>clojure.spec.alpha/def</code>s
in <code>wfl.api.routes</code> for typos
before tearing your hair out.</p>
<h3 id="hacking-a-scratch-database">hacking a scratch database<a class="headerlink" href="#hacking-a-scratch-database" title="Permanent link">&para;</a></h3>
<p>You can test against a local Postgres
before running Liquibase or SQL
against a shared database
in <code>gotc-dev</code> or <em>gasp</em> production.</p>
<p>First install Postgres locally.</p>
<div class="highlight"><pre><span></span><code>brew install postgresql@11
</code></pre></div>
<p>You need version 11 because that
is what Google's hosted service supports,
and there are differences in the SQL syntax.</p>
<p>Modify the value of <code>WFL_POSTGRES_URL</code>
in <code>(postgres/wfl-db-config)</code> to redirect
the WFL server's database
to a local Postgres server.
With that hack in place,
running <code>./ops/server.sh</code>
(or however you launch a local WFL server)
will connect the server to a local Postgres.</p>
<p>Now any changes to WFL state
will affect only your local database.
That includes running Liquibase,
so don't forget to reset <code>:debug</code> to <code>env</code>
before deploying your changes
after merging a PR.</p>
<h3 id="useful-hacks-for-debugging-postgresliquibase-locally">Useful hacks for debugging Postgres/Liquibase locally<a class="headerlink" href="#useful-hacks-for-debugging-postgresliquibase-locally" title="Permanent link">&para;</a></h3>
<p>Starting <code>postgres</code>:
<div class="highlight"><pre><span></span><code>pg_ctl -D /usr/local/var/postgresql@11 start
</code></pre></div></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It might be useful to set up some an alias for postgres if you are using zsh, for
example:
<div class="highlight"><pre><span></span><code>alias pq=&quot;pg_ctl -D /usr/local/var/postgresql@11&quot;
</code></pre></div>
thus you could use <code>pq start</code> or <code>pq stop</code> to easily spin up and turn down the db.</p>
</div>
<p>Running <code>liquibase update</code>:
<div class="highlight"><pre><span></span><code>liquibase --classpath<span class="o">=</span><span class="k">$(</span>clojure -Spath<span class="k">)</span> --url<span class="o">=</span>jdbc:postgresql:wfl --changeLogFile<span class="o">=</span>database/changelog.xml --username<span class="o">=</span><span class="nv">$USER</span> update
</code></pre></div>
For the above, the username and password need to be correct for the target environment.</p>
<p>If you're running a local server with the postgres command above, you don't need a
password and can omit it.</p>
<p>Otherwise, you may be able to find this data in the Vault entry for the
environment's server --
<code>resources/wfl/environments.clj</code> has some environments if you've built locally.
You can use <code>--password=$ENV_SOMETHING</code> to supply it.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It is more convenient to use the following alias to migrate the database schema
from within the <code>api</code> directory:
<div class="highlight"><pre><span></span><code>clojure -A:liquibase
</code></pre></div>
if you are working aginst a local database. If you are working with a CloudSQL
database, the liquibase migration is a encoded step of the <code>cli.py</code>'s <code>deploy</code>
command.</p>
</div>
<h3 id="diagnosis">Diagnosis<a class="headerlink" href="#diagnosis" title="Permanent link">&para;</a></h3>
<p>Workflow Launcher has a diagnostic command, <code>dx</code>,
for debugging problems.</p>
<p>Run <code>wfl dx</code> to get a list of the diagnostics available.</p>
<div class="highlight"><pre><span></span><code>$ java -jar derived/api/target/wfl.jar dx

wfl dx: tools to <span class="nb">help</span> debug workflow problems.

Usage: wfl dx &lt;tool&gt; <span class="o">[</span>&lt;arg&gt; ...<span class="o">]</span>
Where: &lt;tool&gt; is the name of some diagnostic tool.
       &lt;arg&gt; ... are optional arguments to &lt;tool&gt;.

The &lt;tool&gt;s and their &lt;arg&gt;s are named here.
  all-metadata environment <span class="p">&amp;</span> ids
    All workflow metadata <span class="k">for</span> IDS from Cromwell in ENVIRONMENT.
  event-timing environment id
    Time per event <span class="nb">type</span> <span class="k">for</span> workflow with ID in ENVIRONMENT.
...
Error: Must specify a dx &lt;tool&gt; to run.
BTW: You ran: wfl dx
wm28d-f87:wfl yanc$
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href=".." class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Get Started
              </div>
            </div>
          </a>
        
        
          <a href="../dev-sandbox/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Local Development SandBox
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/broadinstitute/wfl" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.77e55a48.min.js"></script>
      <script src="../assets/javascripts/bundle.9554a270.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>